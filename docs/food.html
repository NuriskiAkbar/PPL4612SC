<!DOCTYPE html>
<html>

<head>

    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen,projection" />
    <link rel="stylesheet" href="style.css">

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<!-- <li><a href="sass.html">HOME</a></li>
    <li><a href="badges.html">GRAPH</a></li>
    <li><a href="collapsible.html">MORE</a></li> -->

<body>
    <!-- nabvar -->
    <header>
        <nav class="blue no-shadow">
            <div class="nav-wrapper container">
                <a href="#" class="brand-logo">Admin</a>
                <a href="#" data-target="mobile-demo" class="sidenav-trigger">
                    <i class="material-icons">menu</i></a>
                <ul id="nav-mobile" class="right hide-on-med-and-down">
                    <li><a href="index.html">HOME</a></li>
                    <li><a href="table_page.html">ORDER</a></li>
                    <li><a href="chart_page.html">GRAPH</a></li>
                    <li><a onclick="logout()">MORE</a></li>
                </ul>
            </div>
        </nav>

        <ul class="sidenav" id="mobile-demo">
            <li><a href="index.html">HOME</a></li>
            <li><a href="table_page.html">ORDER</a></li>
            <li><a href="chart_page.html">GRAPH</a></li>
            <li><a onclick="logout()">MORE</a></li>
        </ul>
    </header>
    <main>


        <!-- <div class="atas-tombol">
                <a class="btn-floating btn-large waves-effect waves-light blue add"><i class="material-icons">add</i></a>
            </div> -->

        <!-- floating button -->
        <div class="fixed-action-btn">
            <a class="btn-floating btn-large blue" href="add_page.html">
                <!-- <i class="large material-icons">mode_edit</i> -->
                <i class="material-icons">add</i>
            </a>
        </div>

        <!-- section card -->
        <div class="container">
            <!-- Modal Trigger -->
            <!-- <a class="waves-effect waves-light btn modal-trigger" href="#modal1">Modal</a> -->
            <!-- search bar -->
            <div class="section">
                <nav class="white no-shadow search">
                    <div class="nav-wrapper">
                        <form>
                            <div class="input-field">
                                <input id="search" type="search" required>
                                <label class="label-icon" for="search"><i class="material-icons blue">search</i></label>
                                <i class="material-icons">close</i>
                            </div>
                        </form>
                    </div>
                </nav>
            </div>

            <div class="isi-button">
                <a class="waves-effect waves-light blue tombol btn" id="tombol-food" href="food.html">Food</a>
                <a class="waves-effect waves-light blue tombol btn" id="tombol-drink" href="drink.html">Drink</a>
                <a class="waves-effect waves-light blue tombol btn" id="tombol-drink" href="paling_laku.html">Favorite</a>
                <a class="waves-effect waves-light blue tombol btn" id="tombol-drink" href="menu_baru.html">News</a>
            </div>

            <div class="row white pd-btm">
                <!-- untuk menyimpan nilai sementara -->
                <div style="opacity: 0; font-size: 0rem;" id="editNow"></div>
                <div class="container90" id="card-menu">
                    <!-- card -->

                    <div class="col l4 s12 m6">
                        <div class="card">
                            <div class="card-image bluish">
                                <img src="">
                                <span class="card-title pgn right-align">Rp. 0.000,00</span>
                            </div>
                            <div class="card-content">
                                <span class="card-title">Name</span>
                                <p>I am a very simple card. I am good at containing small bits of information.
                                    I am convenient because I require little markup to use effectively.</p>
                            </div>
                            <div class="card-action">
                                <a href="edit_page.html">EDIT</a>
                                <a class="pinggir" href="#" onclick="tombolHapus()">DELETE</a>
                            </div>
                        </div>
                    </div>

                    <div class="col l4 s12 m6">
                        <div class="card">
                            <div class="card-image bluish ">
                                <img src="">
                                <span class="card-title pgn right-align">Rp. 0.000,00</span>
                            </div>
                            <div class="card-content">
                                <span class="card-title">Name</span>
                                <p>I am a very simple card. I am good at containing small bits of information.
                                    I am convenient because I require little markup to use effectively.</p>
                            </div>
                            <div class="card-action">
                                <a href="#">EDIT</a>
                                <a class="pinggir" href="#"onclick="tombolHapus()">DELETE</a>
                            </div>
                        </div>
                    </div>

                    <div class="col l4 s12 m6">
                        <div class="card">
                            <div class="card-image bluish">
                                <img src="">
                                <span class="card-title pgn right-align">Rp. 0.000,00</span>
                            </div>
                            <div class="card-content">
                                <span class="card-title">Name</span>
                                <p>I am a very simple card. I am good at containing small bits of information.
                                    I am convenient because I require little markup to use effectively.</p>
                            </div>
                            <div class="card-action">
                                <a href="#">EDIT</a>
                                <a class="pinggir" href="#" onclick="tombolHapus()">DELETE</a>
                            </div>
                        </div>
                    </div>


                </div>
            </div>

            <!-- Modal Structure -->
            <div id="modal1" class="modal modal-fixed-footer">
                <div class="modal-content">
                    <h4>Edit Menu</h4>
                    <form class="col s12" action="/admin/docs/index.html">
                        <div class="row panjang">
                            <div class="input-field col s6">
                                <input id="nama" type="text" data-length="10">
                                <label for="input_text">Nama Makanan</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col s6">
                                <input id="harga" type="text" data-length="10">
                                <label for="input_text">Harga</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col s6">
                                <input id="kategori" type="text" data-length="10">
                                <label for="input_text">Ketegori</label>
                                <!-- pisahkan dengan koma -->
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col s12">
                                <textarea id="deskripsi" class="materialize-textarea" data-length="120"></textarea>
                                <label for="textarea2">Deskripsi</label>
                            </div>
                        </div>

                        <!-- <div class="file-field input-field">
                            <div class="btn blue">
                              <span>File</span>
                              <input id="file-image" type="file">
                            </div>
                            <div class="file-path-wrapper">
                              <input class="file-path validate" type="text">
                            </div>
                        </div> -->
                    </form>
                </div>
                <div class="modal-footer">
                    <a href="#!" class="modal-close btn waves-effect waves-light blue kanan" id="tombolEdit"
                        onclick="tombolEdit()">Submit
                        <i class="material-icons right">send</i>
                    </a>
                </div>
            </div>

        </div>
    </main>
    <!--JavaScript at end of body for optimized loading-->
    <script type="text/javascript" src="js/materialize.min.js"></script>
    <script type="text/javascript" src="js/sample.js"></script>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <!-- <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-app.js"></script> -->
    <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-database.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
            https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-analytics.js"></script>

    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-auth.js"></script>
    <!-- <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-database.js"></script> -->
    <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-storage.js"></script>
    <!-- <script type="text/javascript" src="js/experiment.js"></script> -->
    <!-- <script>
        fetchData();
    </script> -->
    <script>
        // src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"
// // Your web app's Firebase configuration
// var firebaseConfig = {
//     apiKey: "AIzaSyBaAAZIojiCukUJfULuLqyR_4DHm8989rA",
//     authDomain: "sistemmanajemenmenu.firebaseapp.com",
//     databaseURL: "https://sistemmanajemenmenu-default-rtdb.firebaseio.com",
//     projectId: "sistemmanajemenmenu",
//     storageBucket: "sistemmanajemenmenu.appspot.com",
//     messagingSenderId: "110856674391",
//     appId: "1:110856674391:web:2d637de74414bae1da9712"
//   };
//   // Initialize Firebase
//   firebase.initializeApp(firebaseConfig);

//Your web app's Firebase configuration
//For Firebase JS SDK v7.20.0 and later, measurementId is optional
var firebaseConfig = {
    apiKey: "AIzaSyDMbejPbMli6gf3i5OUGq09C-HMY9NnMFI",
    authDomain: "apaan-dbc16.firebaseapp.com",
    databaseURL: "https://apaan-dbc16-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "apaan-dbc16",
    storageBucket: "apaan-dbc16.appspot.com",
    messagingSenderId: "412262375065",
    appId: "1:412262375065:web:af929785b8e1c873e5e208",
    measurementId: "G-CQ907QF5E6"
};

// Initialize Firebase
if (!firebase.apps.length) {
    fb = firebase.initializeApp(firebaseConfig);
    firebase.analytics();
}

var database = firebase.database();
var storage = firebase.storage();

//read
database.ref("/").on("value", (data)=>{
    const dt = data.val();
    console.log(dt);
})


const rupiah = (value) => {
    let keluaran = ""
    let keluaran2 = ""
    let counter = 0;
    for (var i = 0; i < value.length; i++) {
        counter++;
        if (counter == 3 && i < (value.length - 1)) {
            keluaran += value.charAt(value.length - i - 1)
            keluaran += "."
            counter = 0;
        } else {
            keluaran += value.charAt(value.length - i - 1)
        }
    }
    keluaran2 = reverseString(keluaran);
    return keluaran2;
}

const reverseString = (str) => {
    return str.split("").reverse().join("");
}


//write
// function kirim(){
// var date = new Date().getTime();
// var data = {iden: date,
// nama: document.getElementById("nama").value,
// harga: document.getElementById("harga").value,
// deskripsi: document.getElementById("deskripsi").value}
// database.ref(`/makanan/${date}`).set(data).then(console.log('kirimed'))
// }
// function app() {
//     document.getElementById('kirim').addEventListener('click', kirim, false);
// }


const kirim = () => {
    let file = document.getElementById("file-image");
    var date = new Date().getTime();
    file = file.files[0];
    let nameFile = `${file.name}`;
    let kat = document.getElementById("kategori").value;
    let nam = document.getElementById("nama").value;
    let katId = nam;
    var up = storage.ref("product").child(nameFile).put(file);
    up.on('state_changed', snapshot => { }, error => { console.log(error) }, () => {
        up.snapshot.ref.getDownloadURL().then(downloadURL => {
            let upl = {
                urlImg: downloadURL,
                docName: nameFile,
                iden: date,
                nama: nam,
                harga: document.getElementById("harga").value,
                kategori: kat,
                deskripsi: document.getElementById("deskripsi").value
            }   
            console.log(upl)
            
            database.ref('/admin/menu/'+kat).child(katId).set(upl).then(() => {
                M.toast({ html: 'Upload Berhasil', classes: 'blue' })
                window.open("/PPL4612SC", "_self");
            }) //admin/docs/index.html
        })

    })
}
src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"


//read
//assign this to a function, so this function only can be triggered at spesific page
    database.ref("/admin/menu/").child("Food").on("value", (dtman) => {
        // console.info(dtman.val());
        let tampil = dtman.val();
        var card = document.getElementById("card-menu");
        let dataht = "";
        // var kunci = document.getElementById("identitas").value = dtman.val().iden;
        for (key in tampil) {
            let a = tampil[key].nama;
            let b = rupiah(tampil[key].harga);
            let c = tampil[key].deskripsi;
            let d = tampil[key].iden;
            let e = tampil[key].urlImg;
            let f = tampil[key].docName;
            dataht += `<div class="col l4 s12 m6">
                        <div class="card">
                            <div class="card-image bluish">
                                <img src="${e}">
                                <span class="card-title pgn right-align">Rp. ${b}</span>
                            </div>
                            <div class="card-content">
                                <span class="card-title">${a}</span>
                                <p>${c}</p>
                            </div>
                            <div class="card-action">
                                <a class="waves-effect waves-light modal-trigger" href="#modal1" onclick="edit(${key})">EDIT</a>
                                <a id="del" class="pinggir"  onclick="hapus(${key}, '${f}')">DELETE</a>
                            </div>
                        </div>
                    </div>`;
            console.log(card);
        }
        card.innerHTML = dataht
    })

// function tombolHapus(){
//     swal({
//         title: "Apakah Anda Yakin?",
//         text: "Data Akan Terhapus",
//         icon: "warning",
//         buttons: true,
//       })
//       .then((willDelete) => {
//         if (willDelete) {
//           swal({
//             title: "Berhasil",
//             text: "Data berhasil di hapus",
//             icon: "success",
//           });
//         } else({
//             title: "Tertunda",
//             text: "Data tidak di hapus",
//             icon: "error",
//         });
//       });
// }

//delete
function hapus(key, nameFile) {

    database.ref("/admin/menu/" + key).on("child_removed").remove();
    storage.ref("product").child(nameFile).delete();
}
// database.ref("/admin/menu").on("child_removed", (hapus) =>{
//     const hapusData = hapus.val();
//     console.info('data \''+ hapusData.nam + '\' berhasil di hapus')
// })
// database.ref("/makanan").remove();

//edit data
function edit(key) {
    database.ref("/admin/menu/" + key).on("value", (datae) => {
        let tampl = datae.val();

        document.getElementById("nama").value = tampl.nama;
        document.getElementById("harga").value = tampl.harga;
        document.getElementById("deskripsi").value = tampl.deskripsi;
        document.getElementById("kategori").value = tampl.kategori;
        //untuk menyimpan  key sementara
        document.getElementById("editNow").innerHTML = key;
        console.log(key);

    });
}

//trigger edit data
function tombolEdit() {
    let key = document.getElementById("editNow").innerHTML;
    let kat = document.getElementById("kategori").value;
    database.ref(`/admin/menu/${key}`).update({
        iden: key,
        nama: document.getElementById("nama").value,
        harga: document.getElementById("harga").value,
        kategori: kat,
        deskripsi: document.getElementById("deskripsi").value
    }).then(document.getElementById("editNow").innerHTML = "");
}


    </script>
</body>

</html>